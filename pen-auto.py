import os
import sys
import subprocess
from datetime import datetime

if len(sys.argv) < 2:
    print("Provide an argument")
    sys.exit(1)

target_name = sys.argv[1]
dirname = target_name
print("Project will be saved in " + target_name)
commands = [
    ["ping", "google.com"],
    ["ping", "amazon.com"]
]

try:
    if os.path.exists(target_name):
        current_time = datetime.now()
        formatted_time = current_time.strftime("%H-%M-%S")
        dirname = dirname + "_" + str(formatted_time)
        os.makedirs(dirname)
    else:
        os.makedirs(dirname)

    os.chdir(dirname)
     

    for i, command in enumerate(commands):
        with open(f"command_{i}.log", "a") as log_file:
            # Open a new command prompt window and execute the command
            print("Running ",command)
            proc = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, creationflags=subprocess.CREATE_NEW_CONSOLE)

            # Wait for the command to complete and get the output
            stdout, stderr = proc.communicate()

            # Decode and write stdout to log file
            if stdout:
                stdout_str = stdout.decode("utf-8")
                log_file.write(stdout_str)
                print(stdout_str.strip())

            # Decode and write stderr to log file
            if stderr:
                stderr_str = stderr.decode("utf-8")
                log_file.write(stderr_str)
                print(stderr_str.strip())

except Exception as e:
    print("Something went wrong:" + str(e))
