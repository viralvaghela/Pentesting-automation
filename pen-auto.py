import os
import sys
import subprocess
from datetime import datetime
if len(sys.argv)<2:
    print("Provide an argument")
    sys.exit(1)


target_name=sys.argv[1]
dirname=target_name
print("Project will be saved in "+target_name)
commands = [
    ["ping", "google.com"], #update it later...
    ["ping", "amazon.com"]  #update it later...
 ]


try:
    if os.path.exists(target_name):
        # Get the current time
        current_time = datetime.now()

        # Format the current time as a string without characters that are not allowed in filenames
        formatted_time = current_time.strftime("%H-%M-%S")
        dirname=dirname+"_"+str(formatted_time)
        os.makedirs(dirname)
        
    else:
        os.makedirs(dirname)
    
    os.chdir(dirname)
    print("Running ping1")
    for i, command in enumerate(commands):
        with open(f"command_{i}.log", "a") as log_file:
            # Open a new command prompt window and execute the command
            proc = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, creationflags=subprocess.CREATE_NEW_CONSOLE)

         
            while True:
                line = proc.stdout.readline().decode("utf-8")
                if not line:
                    break
                print(line.strip())
                log_file.write(line)

            # Read the error output of the command and write it to both command prompt and log file
            while True:
                line = proc.stderr.readline().decode("utf-8")
                if not line:
                    break
                print(line.strip())
                log_file.write(line)
        
except Exception as e:
    print("Something went wrong:" +str(e))
